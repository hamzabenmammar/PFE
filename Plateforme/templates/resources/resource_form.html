{% extends "base.html" %}
{% load static crispy_forms_tags i18n %}

{% block title %}{% trans "Create New Resource" %}{% endblock title%}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4">{% trans "Create New Resource" %}</h1>
    
    <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        {% crispy form %}  <!-- Le bouton Submit est inclus ici via FormHelper -->
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 1. Configuration des correspondances FR -> IDs
    const resourceTypeToId = {
        'cours': 'cours-fields',
        'outil': 'outil-fields',
        'corpus': 'corpus-fields',
        'document': 'document-fields'
    };

    const documentTypeToId = {
        'article': 'article-fields',
        'these': 'these-fields', 
        'memoire': 'memoire-fields'
    };

    // 2. Fonction principale pour basculer les champs
    function updateFields() {
        // Masquer TOUS les champs spécifiques
        document.querySelectorAll('.specific-field').forEach(el => el.style.display = 'none');
        
        // Afficher le type principal
        const mainType = document.getElementById('id_resource_type').value;
        if (resourceTypeToId[mainType]) {
            document.getElementById(resourceTypeToId[mainType]).style.display = 'block';
        }

        // Gérer les sous-types de document
        if (mainType === 'document') {
            const docType = document.getElementById('id_document_type')?.value;
            if (docType && documentTypeToId[docType]) {
                document.getElementById(documentTypeToId[docType]).style.display = 'block';
            }
        }
    }

    // 3. Écouteurs d'événements
    document.getElementById('id_resource_type').addEventListener('change', updateFields);
    document.getElementById('id_document_type')?.addEventListener('change', updateFields);
    
    // 4. Initialisation au chargement
    updateFields();
});
</script>
{% endblock %}

{% block extra_css %}
<style>
/* Masquer les champs spécifiques par défaut */
.specific-field { 
    display: none !important;
    margin-top: 20px;
    border-left: 3px solid #0d6efd;
    padding: 15px;
}
</style>
{% endblock %}