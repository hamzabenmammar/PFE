{% extends 'main.html' %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block content %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const typeSelector = document.getElementById('id_resource_type');
    const docTypeSelector = document.getElementById('id_document_type');
    const allFields = document.querySelectorAll('.specific-field');

    function updateFields() {
        // Masquer tous les champs spécifiques
        allFields.forEach(field => field.style.display = 'none');
        
        const selectedType = typeSelector.value;
        
        // Afficher les champs correspondants au type principal
        if (selectedType === 'cours') {
            document.getElementById('cours-fields').style.display = 'block';
        } 
        else if (selectedType === 'outil') {
            document.getElementById('outil-fields').style.display = 'block';
        }
        else if (selectedType === 'corpus') {
            document.getElementById('corpus-fields').style.display = 'block';
        }
        else if (selectedType === 'document') {
            // Afficher d'abord les champs génériques de document
            document.getElementById('document-fields').style.display = 'block';
            
            // Gestion des sous-types de document
            const docType = docTypeSelector ? docTypeSelector.value : null;
            if (docType === 'article') {
                document.getElementById('article-fields').style.display = 'block';
            }
            else if (docType === 'these') {
                document.getElementById('these-fields').style.display = 'block';
            }
            else if (docType === 'memoire') {
                document.getElementById('memoire-fields').style.display = 'block';
            }
        }
    }

    // Écouteurs d'événements
    typeSelector.addEventListener('change', function() {
        // Masquer les sous-champs de document quand on change le type principal
        if (this.value !== 'document') {
            ['article-fields', 'these-fields', 'memoire-fields'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
        }
        updateFields();
    });

    if (docTypeSelector) {
        docTypeSelector.addEventListener('change', updateFields);
    }

    // Initialisation
    updateFields();
    
    // Validation dynamique
    document.querySelector('form').addEventListener('submit', function(e) {
        const selectedType = typeSelector.value;
        let isValid = true;

        // Validation pour les cours
        if (selectedType === 'cours') {
            const requiredFields = [
                'domaine_cours', 'niveau_cours', 
                'enseignant_cours', 'universite_cours',
                'annee_academique_cours'
            ];
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(`id_${fieldId}`);
                if (field && !field.value) {
                    field.classList.add('is-invalid');
                    isValid = false;
                }
            });
        }
        
        // Ajouter des validations similaires pour les autres types...

        if (!isValid) {
            e.preventDefault();
            alert('Veuillez remplir tous les champs obligatoires pour ce type de ressource');
        }
    });
});
</script>


<style>
.specific-field {
    display: none;
    margin-top: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 5px;
    border-left: 4px solid #0d6efd;
}
.is-invalid {
    border-color: #dc3545 !important;
}
</style>
{% endblock %}
<div class="container mt-4">
    <h2 class="mb-4">{% trans "Ajouter une ressource" %}</h2>
    {% crispy form %}
</div>
{% endblock %}